# Universal Knowledge Extraction Template - Unified Entity + Relationship Extraction
# Automatically adapts to ANY domain without hardcoded assumptions
# Extracts entities AND their real contextual relationships together
# Configuration: {{ content_signature|default("universal") }} (Confidence: {{ content_confidence|default(0.8) }})

system:
You are an expert knowledge analyst specializing in {{ discovered_content_description }}. Your expertise helps identify both meaningful entities AND their real contextual relationships that professionals need to understand in this domain.

CRITICAL: Extract entities and relationships TOGETHER to preserve the real contextual connections that exist in the actual content.

user:
## Context: Universal Knowledge Extraction (Unified Approach)

**Your Role**: Build a comprehensive knowledge graph for {{ discovered_content_description }} that captures both entities and their real relationships as they actually appear in the content.

**Content Intelligence**: Based on analysis, this content focuses on:
{{ discovered_entity_types|join(', ') }} with key concepts: {{ key_content_terms|join(', ') }}

**Content Patterns Discovered**:
{% for pattern in discovered_content_patterns %}
- **{{ pattern.category }}**: {{ pattern.description }}
{% endfor %}

**Quality Standards**: Extract knowledge that helps professionals understand:
{% for insight in key_domain_insights %}
{{ loop.index }}. {{ insight }}
{% endfor %}

## Content to Analyze:

{% for text in texts %}
**Document {{ loop.index }}**: {{ text }}
{% endfor %}

## Required Output Format:

Extract ALL meaningful entities AND their contextual relationships in one unified analysis. Return a JSON object with both entities and relationships:

```json
{
  "entities": [
    {
      "entity_id": "entity_1", 
      "text": "exact_text_from_content",
      "entity_type": "discovered_type_from_key_terms",
      "confidence": {{ entity_confidence_threshold }},
      "context": "surrounding text context",
      "source_document": 1,
      "semantic_role": "role_in_{{ content_signature }}"
    }
  ],
  "relationships": [
    {
      "relation_id": "rel_1",
      "source_entity": "entity_1",
      "target_entity": "entity_2", 
      "relation_type": "discovered_from_content",
      "confidence": {{ relationship_confidence_threshold }},
      "context": "exact text showing this relationship",
      "source_document": 1,
      "direction": "directed_or_undirected"
    }
  ]
}
```

**Unified Extraction Guidelines**:

1. **Entity Extraction**:
   - Extract entities exactly as they appear in content
   - Use types derived from key content terms: {{ discovered_entity_types|join(', ') }}
   - Focus on entities relevant to: {{ key_content_terms|join(', ') }}
   - Assign confidence based on clarity (threshold: {{ entity_confidence_threshold|default(0.7) }})

2. **Relationship Extraction** (CRITICAL - Extract from SAME context):
   - Identify relationships between extracted entities as they actually appear in content
   - Use relationship types discovered from content patterns: {{ discovered_relationship_types|join(', ') }}
   - Focus on relationships that connect the key concepts: {{ key_content_terms|join(', ') }}  
   - Extract both explicit (directly stated) and clearly implied relationships
   - Assign confidence based on contextual clarity (threshold: {{ relationship_confidence_threshold }})

3. **Contextual Coherence**:
   - Ensure relationships only connect entities that actually interact in the content
   - Preserve the semantic meaning of how entities relate in {{ discovered_content_description }}
   - Maintain content-specific terminology and relationship expressions
   - Focus on relationships that matter for {{ content_signature }} understanding

**Quality Focus**:
- Extract knowledge that enables domain-specific reasoning about {{ key_content_terms|join(' and ') }}
- Include hierarchical, causal, and functional relationships as they appear
- Capture both concrete and conceptual connections
- Prioritize relationships that help professionals work with {{ discovered_content_description }}

Extract comprehensive knowledge that preserves the real contextual relationships found in the content. Entity-relationship coherence is critical for building a useful knowledge graph.

# Auto-generated by Universal Domain Intelligence Agent  
# Content signature: {{ content_signature }}
# Key content terms: {{ key_content_terms|join(', ') }}
# Vocabulary richness: {{ vocabulary_richness }}
# Concept density: {{ concept_density }}
# Processing time: {{ analysis_processing_time }}s