# Dataflow Pipeline Outputs

This directory contains the outputs from the Azure Universal RAG dataflow pipeline processing.

## Directory Structure

```
outputs/
├── README.md                    # This file
├── step02/                      # Knowledge Extraction outputs
│   ├── step02_knowledge_extraction_results.json     # Raw extraction results (540 entities, 597 relationships)
│   ├── step02_knowledge_extraction_analysis_report.md  # Detailed analysis report
│   └── knowledge_analysis_summary.json             # Statistical summary
└── step04/                      # PyTorch Geometric Graph Construction outputs
    ├── graph_construction_results.json             # Execution statistics and metadata
    ├── node_mapping_maintenance.json               # Entity-to-node ID mapping for reference
    └── pytorch_geometric_maintenance.pt            # PyTorch Geometric Data object (540 nodes, 1178 edges)
```

## File Descriptions

### Step 02: Knowledge Extraction
- **Domain**: Maintenance
- **Source**: 321 individual maintenance items from `data/raw/demo_sample_10percent.md`
- **Processing**: Azure OpenAI GPT-4o with template-based extraction
- **Results**: 540 entities, 597 relationships with 85% accuracy
- **Duration**: ~11.2 minutes (rate limited at 60 requests/minute)

### Step 04: PyTorch Geometric Graph Construction
- **Input**: Step 02 knowledge extraction results
- **Processing**: Domain-configured PyTorch Geometric conversion
- **Output**: Graph Neural Network ready format
- **Features**: 64D node features, 32D edge features, 10 entity classes
- **Architecture**: Bidirectional edges for undirected graph representation
- **Duration**: ~2.4 seconds

## Data Flow

```
Raw Text (Step 01) → Knowledge Extraction (Step 02) → PyTorch Geometric (Step 04) → GNN Training (Step 05)
```

## Usage

### Loading PyTorch Geometric Data
```python
import torch
from torch_geometric.data import Data

# Load the graph data
data_dict = torch.load('step04/pytorch_geometric_maintenance.pt', weights_only=False)
graph_data = data_dict['data']  # PyTorch Geometric Data object
node_mapping = data_dict['node_mapping']  # Entity mapping reference

print(f"Nodes: {graph_data.x.size(0)}")
print(f"Edges: {graph_data.edge_index.size(1)}")
print(f"Node features: {graph_data.x.size(1)}D")
print(f"Edge features: {graph_data.edge_attr.size(1)}D")
```

### Loading Knowledge Extraction Results
```python
import json

# Load extracted knowledge
with open('step02/step02_knowledge_extraction_results.json', 'r') as f:
    knowledge_data = json.load(f)

entities = knowledge_data['knowledge_data']['entities']
relationships = knowledge_data['knowledge_data']['relationships']
print(f"Extracted: {len(entities)} entities, {len(relationships)} relationships")
```

## File Lifecycle

- **step02/**: Generated by `scripts/dataflow/02_knowledge_extraction.py`
- **step04/**: Generated by `scripts/dataflow/04_graph_construction.py`
- **Cleanup**: Old timestamped files are removed to maintain clean directory structure
- **Archival**: Important results are kept with clean, consistent naming

## Quality Metrics

### Knowledge Extraction Quality
- **Entity Type Distribution**: component (47%), equipment (19%), issue (10%)
- **Relationship Richness**: 108 unique relationship types
- **Domain Alignment**: 55.5% alignment with maintenance patterns
- **Processing Efficiency**: 60% cache hit rate, 99% reduction in repeat processing

### Graph Construction Quality  
- **Graph Connectivity**: 1.1 relationships per entity (optimal for GNN training)
- **Edge Creation Success**: 98.7% valid edges (589/597 relationships)
- **GNN Readiness Score**: 7.8/10 - excellent for training
- **Feature Engineering**: Domain-configured 64D node and 32D edge features

For more details, see [PyTorch Geometric Guide](../../PYTORCH_GEOMETRIC_GUIDE.md).